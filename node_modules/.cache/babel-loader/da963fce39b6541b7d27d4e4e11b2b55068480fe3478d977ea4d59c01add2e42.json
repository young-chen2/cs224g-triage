{"ast":null,"code":"import { BaseChain } from \"../base.js\";\nimport { LLMChain } from \"../llm_chain.js\";\nimport { API_URL_PROMPT_TEMPLATE, API_RESPONSE_PROMPT_TEMPLATE } from \"./prompts.js\";\n/**\n * Class that extends BaseChain and represents a chain specifically\n * designed for making API requests and processing API responses.\n */\nexport class APIChain extends BaseChain {\n  get inputKeys() {\n    return [this.inputKey];\n  }\n  get outputKeys() {\n    return [this.outputKey];\n  }\n  constructor(fields) {\n    super(fields);\n    Object.defineProperty(this, \"apiAnswerChain\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"apiRequestChain\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"apiDocs\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"headers\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: {}\n    });\n    Object.defineProperty(this, \"inputKey\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: \"question\"\n    });\n    Object.defineProperty(this, \"outputKey\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: \"output\"\n    });\n    this.apiRequestChain = fields.apiRequestChain;\n    this.apiAnswerChain = fields.apiAnswerChain;\n    this.apiDocs = fields.apiDocs;\n    this.inputKey = fields.inputKey ?? this.inputKey;\n    this.outputKey = fields.outputKey ?? this.outputKey;\n    this.headers = fields.headers ?? this.headers;\n  }\n  /** @ignore */\n  async _call(values, runManager) {\n    const question = values[this.inputKey];\n    const api_url = await this.apiRequestChain.predict({\n      question,\n      api_docs: this.apiDocs\n    }, runManager?.getChild(\"request\"));\n    const res = await fetch(api_url, {\n      headers: this.headers\n    });\n    const api_response = await res.text();\n    const answer = await this.apiAnswerChain.predict({\n      question,\n      api_docs: this.apiDocs,\n      api_url,\n      api_response\n    }, runManager?.getChild(\"response\"));\n    return {\n      [this.outputKey]: answer\n    };\n  }\n  _chainType() {\n    return \"api_chain\";\n  }\n  static async deserialize(data) {\n    const {\n      api_request_chain,\n      api_answer_chain,\n      api_docs\n    } = data;\n    if (!api_request_chain) {\n      throw new Error(\"LLMChain must have api_request_chain\");\n    }\n    if (!api_answer_chain) {\n      throw new Error(\"LLMChain must have api_answer_chain\");\n    }\n    if (!api_docs) {\n      throw new Error(\"LLMChain must have api_docs\");\n    }\n    return new APIChain({\n      apiAnswerChain: await LLMChain.deserialize(api_answer_chain),\n      apiRequestChain: await LLMChain.deserialize(api_request_chain),\n      apiDocs: api_docs\n    });\n  }\n  serialize() {\n    return {\n      _type: this._chainType(),\n      api_answer_chain: this.apiAnswerChain.serialize(),\n      api_request_chain: this.apiRequestChain.serialize(),\n      api_docs: this.apiDocs\n    };\n  }\n  /**\n   * Static method to create a new APIChain from a BaseLanguageModel and API\n   * documentation.\n   * @param llm BaseLanguageModel instance.\n   * @param apiDocs API documentation.\n   * @param options Optional configuration options for the APIChain.\n   * @returns New APIChain instance.\n   */\n  static fromLLMAndAPIDocs(llm, apiDocs, options = {}) {\n    const {\n      apiUrlPrompt = API_URL_PROMPT_TEMPLATE,\n      apiResponsePrompt = API_RESPONSE_PROMPT_TEMPLATE\n    } = options;\n    const apiRequestChain = new LLMChain({\n      prompt: apiUrlPrompt,\n      llm\n    });\n    const apiAnswerChain = new LLMChain({\n      prompt: apiResponsePrompt,\n      llm\n    });\n    return new this({\n      apiAnswerChain,\n      apiRequestChain,\n      apiDocs,\n      ...options\n    });\n  }\n}","map":{"version":3,"names":["BaseChain","LLMChain","API_URL_PROMPT_TEMPLATE","API_RESPONSE_PROMPT_TEMPLATE","APIChain","inputKeys","inputKey","outputKeys","outputKey","constructor","fields","Object","defineProperty","enumerable","configurable","writable","value","apiRequestChain","apiAnswerChain","apiDocs","headers","_call","values","runManager","question","api_url","predict","api_docs","getChild","res","fetch","api_response","text","answer","_chainType","deserialize","data","api_request_chain","api_answer_chain","Error","serialize","_type","fromLLMAndAPIDocs","llm","options","apiUrlPrompt","apiResponsePrompt","prompt"],"sources":["/Users/youngchen/Downloads/cs224g-triage/node_modules/langchain/dist/chains/api/api_chain.js"],"sourcesContent":["import { BaseChain } from \"../base.js\";\nimport { LLMChain } from \"../llm_chain.js\";\nimport { API_URL_PROMPT_TEMPLATE, API_RESPONSE_PROMPT_TEMPLATE, } from \"./prompts.js\";\n/**\n * Class that extends BaseChain and represents a chain specifically\n * designed for making API requests and processing API responses.\n */\nexport class APIChain extends BaseChain {\n    get inputKeys() {\n        return [this.inputKey];\n    }\n    get outputKeys() {\n        return [this.outputKey];\n    }\n    constructor(fields) {\n        super(fields);\n        Object.defineProperty(this, \"apiAnswerChain\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"apiRequestChain\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"apiDocs\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"headers\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: {}\n        });\n        Object.defineProperty(this, \"inputKey\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"question\"\n        });\n        Object.defineProperty(this, \"outputKey\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"output\"\n        });\n        this.apiRequestChain = fields.apiRequestChain;\n        this.apiAnswerChain = fields.apiAnswerChain;\n        this.apiDocs = fields.apiDocs;\n        this.inputKey = fields.inputKey ?? this.inputKey;\n        this.outputKey = fields.outputKey ?? this.outputKey;\n        this.headers = fields.headers ?? this.headers;\n    }\n    /** @ignore */\n    async _call(values, runManager) {\n        const question = values[this.inputKey];\n        const api_url = await this.apiRequestChain.predict({ question, api_docs: this.apiDocs }, runManager?.getChild(\"request\"));\n        const res = await fetch(api_url, { headers: this.headers });\n        const api_response = await res.text();\n        const answer = await this.apiAnswerChain.predict({ question, api_docs: this.apiDocs, api_url, api_response }, runManager?.getChild(\"response\"));\n        return { [this.outputKey]: answer };\n    }\n    _chainType() {\n        return \"api_chain\";\n    }\n    static async deserialize(data) {\n        const { api_request_chain, api_answer_chain, api_docs } = data;\n        if (!api_request_chain) {\n            throw new Error(\"LLMChain must have api_request_chain\");\n        }\n        if (!api_answer_chain) {\n            throw new Error(\"LLMChain must have api_answer_chain\");\n        }\n        if (!api_docs) {\n            throw new Error(\"LLMChain must have api_docs\");\n        }\n        return new APIChain({\n            apiAnswerChain: await LLMChain.deserialize(api_answer_chain),\n            apiRequestChain: await LLMChain.deserialize(api_request_chain),\n            apiDocs: api_docs,\n        });\n    }\n    serialize() {\n        return {\n            _type: this._chainType(),\n            api_answer_chain: this.apiAnswerChain.serialize(),\n            api_request_chain: this.apiRequestChain.serialize(),\n            api_docs: this.apiDocs,\n        };\n    }\n    /**\n     * Static method to create a new APIChain from a BaseLanguageModel and API\n     * documentation.\n     * @param llm BaseLanguageModel instance.\n     * @param apiDocs API documentation.\n     * @param options Optional configuration options for the APIChain.\n     * @returns New APIChain instance.\n     */\n    static fromLLMAndAPIDocs(llm, apiDocs, options = {}) {\n        const { apiUrlPrompt = API_URL_PROMPT_TEMPLATE, apiResponsePrompt = API_RESPONSE_PROMPT_TEMPLATE, } = options;\n        const apiRequestChain = new LLMChain({ prompt: apiUrlPrompt, llm });\n        const apiAnswerChain = new LLMChain({ prompt: apiResponsePrompt, llm });\n        return new this({\n            apiAnswerChain,\n            apiRequestChain,\n            apiDocs,\n            ...options,\n        });\n    }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}