{"ast":null,"code":"import { AzureOpenAI as AzureOpenAIClient } from \"openai\";\nimport { getEnvironmentVariable } from \"@langchain/core/utils/env\";\nimport { OpenAI } from \"../llms.js\";\nimport { getEndpoint } from \"../utils/azure.js\";\nexport class AzureOpenAI extends OpenAI {\n  get lc_aliases() {\n    return {\n      ...super.lc_aliases,\n      openAIApiKey: \"openai_api_key\",\n      openAIApiVersion: \"openai_api_version\",\n      openAIBasePath: \"openai_api_base\",\n      deploymentName: \"deployment_name\",\n      azureOpenAIEndpoint: \"azure_endpoint\",\n      azureOpenAIApiVersion: \"openai_api_version\",\n      azureOpenAIBasePath: \"openai_api_base\",\n      azureOpenAIApiDeploymentName: \"deployment_name\"\n    };\n  }\n  get lc_secrets() {\n    return {\n      ...super.lc_secrets,\n      azureOpenAIApiKey: \"AZURE_OPENAI_API_KEY\"\n    };\n  }\n  constructor(fields) {\n    super(fields);\n    Object.defineProperty(this, \"azureOpenAIApiVersion\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"azureOpenAIApiKey\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"azureADTokenProvider\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"azureOpenAIApiInstanceName\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"azureOpenAIApiDeploymentName\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"azureOpenAIBasePath\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"azureOpenAIEndpoint\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    this.azureOpenAIApiDeploymentName = (fields?.azureOpenAIApiCompletionsDeploymentName || fields?.azureOpenAIApiDeploymentName) ?? (getEnvironmentVariable(\"AZURE_OPENAI_API_COMPLETIONS_DEPLOYMENT_NAME\") || getEnvironmentVariable(\"AZURE_OPENAI_API_DEPLOYMENT_NAME\"));\n    this.azureOpenAIApiKey = fields?.azureOpenAIApiKey ?? fields?.openAIApiKey ?? fields?.apiKey ?? getEnvironmentVariable(\"AZURE_OPENAI_API_KEY\");\n    this.azureOpenAIApiInstanceName = fields?.azureOpenAIApiInstanceName ?? getEnvironmentVariable(\"AZURE_OPENAI_API_INSTANCE_NAME\");\n    this.azureOpenAIApiVersion = fields?.azureOpenAIApiVersion ?? fields?.openAIApiVersion ?? getEnvironmentVariable(\"AZURE_OPENAI_API_VERSION\");\n    this.azureOpenAIBasePath = fields?.azureOpenAIBasePath ?? getEnvironmentVariable(\"AZURE_OPENAI_BASE_PATH\");\n    this.azureOpenAIEndpoint = fields?.azureOpenAIEndpoint ?? getEnvironmentVariable(\"AZURE_OPENAI_ENDPOINT\");\n    this.azureADTokenProvider = fields?.azureADTokenProvider;\n    if (!this.azureOpenAIApiKey && !this.apiKey && !this.azureADTokenProvider) {\n      throw new Error(\"Azure OpenAI API key or Token Provider not found\");\n    }\n  }\n  _getClientOptions(options) {\n    if (!this.client) {\n      const openAIEndpointConfig = {\n        azureOpenAIApiDeploymentName: this.azureOpenAIApiDeploymentName,\n        azureOpenAIApiInstanceName: this.azureOpenAIApiInstanceName,\n        azureOpenAIApiKey: this.azureOpenAIApiKey,\n        azureOpenAIBasePath: this.azureOpenAIBasePath,\n        azureADTokenProvider: this.azureADTokenProvider,\n        baseURL: this.clientConfig.baseURL\n      };\n      const endpoint = getEndpoint(openAIEndpointConfig);\n      const params = {\n        ...this.clientConfig,\n        baseURL: endpoint,\n        timeout: this.timeout,\n        maxRetries: 0\n      };\n      if (!this.azureADTokenProvider) {\n        params.apiKey = openAIEndpointConfig.azureOpenAIApiKey;\n      }\n      if (!params.baseURL) {\n        delete params.baseURL;\n      }\n      params.defaultHeaders = {\n        ...params.defaultHeaders,\n        \"User-Agent\": params.defaultHeaders?.[\"User-Agent\"] ? `${params.defaultHeaders[\"User-Agent\"]}: langchainjs-azure-openai-v2` : `langchainjs-azure-openai-v2`\n      };\n      this.client = new AzureOpenAIClient({\n        apiVersion: this.azureOpenAIApiVersion,\n        azureADTokenProvider: this.azureADTokenProvider,\n        ...params\n      });\n    }\n    const requestOptions = {\n      ...this.clientConfig,\n      ...options\n    };\n    if (this.azureOpenAIApiKey) {\n      requestOptions.headers = {\n        \"api-key\": this.azureOpenAIApiKey,\n        ...requestOptions.headers\n      };\n      requestOptions.query = {\n        \"api-version\": this.azureOpenAIApiVersion,\n        ...requestOptions.query\n      };\n    }\n    return requestOptions;\n  }\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  toJSON() {\n    const json = super.toJSON();\n    function isRecord(obj) {\n      return typeof obj === \"object\" && obj != null;\n    }\n    if (isRecord(json) && isRecord(json.kwargs)) {\n      delete json.kwargs.azure_openai_base_path;\n      delete json.kwargs.azure_openai_api_deployment_name;\n      delete json.kwargs.azure_openai_api_key;\n      delete json.kwargs.azure_openai_api_version;\n      delete json.kwargs.azure_open_ai_base_path;\n    }\n    return json;\n  }\n}","map":{"version":3,"names":["AzureOpenAI","AzureOpenAIClient","getEnvironmentVariable","OpenAI","getEndpoint","lc_aliases","openAIApiKey","openAIApiVersion","openAIBasePath","deploymentName","azureOpenAIEndpoint","azureOpenAIApiVersion","azureOpenAIBasePath","azureOpenAIApiDeploymentName","lc_secrets","azureOpenAIApiKey","constructor","fields","Object","defineProperty","enumerable","configurable","writable","value","azureOpenAIApiCompletionsDeploymentName","apiKey","azureOpenAIApiInstanceName","azureADTokenProvider","Error","_getClientOptions","options","client","openAIEndpointConfig","baseURL","clientConfig","endpoint","params","timeout","maxRetries","defaultHeaders","apiVersion","requestOptions","headers","query","toJSON","json","isRecord","obj","kwargs","azure_openai_base_path","azure_openai_api_deployment_name","azure_openai_api_key","azure_openai_api_version","azure_open_ai_base_path"],"sources":["/Users/youngchen/Downloads/cs224g-triage/node_modules/@langchain/openai/dist/azure/llms.js"],"sourcesContent":["import { AzureOpenAI as AzureOpenAIClient } from \"openai\";\nimport { getEnvironmentVariable } from \"@langchain/core/utils/env\";\nimport { OpenAI } from \"../llms.js\";\nimport { getEndpoint } from \"../utils/azure.js\";\nexport class AzureOpenAI extends OpenAI {\n    get lc_aliases() {\n        return {\n            ...super.lc_aliases,\n            openAIApiKey: \"openai_api_key\",\n            openAIApiVersion: \"openai_api_version\",\n            openAIBasePath: \"openai_api_base\",\n            deploymentName: \"deployment_name\",\n            azureOpenAIEndpoint: \"azure_endpoint\",\n            azureOpenAIApiVersion: \"openai_api_version\",\n            azureOpenAIBasePath: \"openai_api_base\",\n            azureOpenAIApiDeploymentName: \"deployment_name\",\n        };\n    }\n    get lc_secrets() {\n        return {\n            ...super.lc_secrets,\n            azureOpenAIApiKey: \"AZURE_OPENAI_API_KEY\",\n        };\n    }\n    constructor(fields) {\n        super(fields);\n        Object.defineProperty(this, \"azureOpenAIApiVersion\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"azureOpenAIApiKey\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"azureADTokenProvider\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"azureOpenAIApiInstanceName\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"azureOpenAIApiDeploymentName\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"azureOpenAIBasePath\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"azureOpenAIEndpoint\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.azureOpenAIApiDeploymentName =\n            (fields?.azureOpenAIApiCompletionsDeploymentName ||\n                fields?.azureOpenAIApiDeploymentName) ??\n                (getEnvironmentVariable(\"AZURE_OPENAI_API_COMPLETIONS_DEPLOYMENT_NAME\") ||\n                    getEnvironmentVariable(\"AZURE_OPENAI_API_DEPLOYMENT_NAME\"));\n        this.azureOpenAIApiKey =\n            fields?.azureOpenAIApiKey ??\n                fields?.openAIApiKey ??\n                fields?.apiKey ??\n                getEnvironmentVariable(\"AZURE_OPENAI_API_KEY\");\n        this.azureOpenAIApiInstanceName =\n            fields?.azureOpenAIApiInstanceName ??\n                getEnvironmentVariable(\"AZURE_OPENAI_API_INSTANCE_NAME\");\n        this.azureOpenAIApiVersion =\n            fields?.azureOpenAIApiVersion ??\n                fields?.openAIApiVersion ??\n                getEnvironmentVariable(\"AZURE_OPENAI_API_VERSION\");\n        this.azureOpenAIBasePath =\n            fields?.azureOpenAIBasePath ??\n                getEnvironmentVariable(\"AZURE_OPENAI_BASE_PATH\");\n        this.azureOpenAIEndpoint =\n            fields?.azureOpenAIEndpoint ??\n                getEnvironmentVariable(\"AZURE_OPENAI_ENDPOINT\");\n        this.azureADTokenProvider = fields?.azureADTokenProvider;\n        if (!this.azureOpenAIApiKey && !this.apiKey && !this.azureADTokenProvider) {\n            throw new Error(\"Azure OpenAI API key or Token Provider not found\");\n        }\n    }\n    _getClientOptions(options) {\n        if (!this.client) {\n            const openAIEndpointConfig = {\n                azureOpenAIApiDeploymentName: this.azureOpenAIApiDeploymentName,\n                azureOpenAIApiInstanceName: this.azureOpenAIApiInstanceName,\n                azureOpenAIApiKey: this.azureOpenAIApiKey,\n                azureOpenAIBasePath: this.azureOpenAIBasePath,\n                azureADTokenProvider: this.azureADTokenProvider,\n                baseURL: this.clientConfig.baseURL,\n            };\n            const endpoint = getEndpoint(openAIEndpointConfig);\n            const params = {\n                ...this.clientConfig,\n                baseURL: endpoint,\n                timeout: this.timeout,\n                maxRetries: 0,\n            };\n            if (!this.azureADTokenProvider) {\n                params.apiKey = openAIEndpointConfig.azureOpenAIApiKey;\n            }\n            if (!params.baseURL) {\n                delete params.baseURL;\n            }\n            params.defaultHeaders = {\n                ...params.defaultHeaders,\n                \"User-Agent\": params.defaultHeaders?.[\"User-Agent\"]\n                    ? `${params.defaultHeaders[\"User-Agent\"]}: langchainjs-azure-openai-v2`\n                    : `langchainjs-azure-openai-v2`,\n            };\n            this.client = new AzureOpenAIClient({\n                apiVersion: this.azureOpenAIApiVersion,\n                azureADTokenProvider: this.azureADTokenProvider,\n                ...params,\n            });\n        }\n        const requestOptions = {\n            ...this.clientConfig,\n            ...options,\n        };\n        if (this.azureOpenAIApiKey) {\n            requestOptions.headers = {\n                \"api-key\": this.azureOpenAIApiKey,\n                ...requestOptions.headers,\n            };\n            requestOptions.query = {\n                \"api-version\": this.azureOpenAIApiVersion,\n                ...requestOptions.query,\n            };\n        }\n        return requestOptions;\n    }\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    toJSON() {\n        const json = super.toJSON();\n        function isRecord(obj) {\n            return typeof obj === \"object\" && obj != null;\n        }\n        if (isRecord(json) && isRecord(json.kwargs)) {\n            delete json.kwargs.azure_openai_base_path;\n            delete json.kwargs.azure_openai_api_deployment_name;\n            delete json.kwargs.azure_openai_api_key;\n            delete json.kwargs.azure_openai_api_version;\n            delete json.kwargs.azure_open_ai_base_path;\n        }\n        return json;\n    }\n}\n"],"mappings":"AAAA,SAASA,WAAW,IAAIC,iBAAiB,QAAQ,QAAQ;AACzD,SAASC,sBAAsB,QAAQ,2BAA2B;AAClE,SAASC,MAAM,QAAQ,YAAY;AACnC,SAASC,WAAW,QAAQ,mBAAmB;AAC/C,OAAO,MAAMJ,WAAW,SAASG,MAAM,CAAC;EACpC,IAAIE,UAAUA,CAAA,EAAG;IACb,OAAO;MACH,GAAG,KAAK,CAACA,UAAU;MACnBC,YAAY,EAAE,gBAAgB;MAC9BC,gBAAgB,EAAE,oBAAoB;MACtCC,cAAc,EAAE,iBAAiB;MACjCC,cAAc,EAAE,iBAAiB;MACjCC,mBAAmB,EAAE,gBAAgB;MACrCC,qBAAqB,EAAE,oBAAoB;MAC3CC,mBAAmB,EAAE,iBAAiB;MACtCC,4BAA4B,EAAE;IAClC,CAAC;EACL;EACA,IAAIC,UAAUA,CAAA,EAAG;IACb,OAAO;MACH,GAAG,KAAK,CAACA,UAAU;MACnBC,iBAAiB,EAAE;IACvB,CAAC;EACL;EACAC,WAAWA,CAACC,MAAM,EAAE;IAChB,KAAK,CAACA,MAAM,CAAC;IACbC,MAAM,CAACC,cAAc,CAAC,IAAI,EAAE,uBAAuB,EAAE;MACjDC,UAAU,EAAE,IAAI;MAChBC,YAAY,EAAE,IAAI;MAClBC,QAAQ,EAAE,IAAI;MACdC,KAAK,EAAE,KAAK;IAChB,CAAC,CAAC;IACFL,MAAM,CAACC,cAAc,CAAC,IAAI,EAAE,mBAAmB,EAAE;MAC7CC,UAAU,EAAE,IAAI;MAChBC,YAAY,EAAE,IAAI;MAClBC,QAAQ,EAAE,IAAI;MACdC,KAAK,EAAE,KAAK;IAChB,CAAC,CAAC;IACFL,MAAM,CAACC,cAAc,CAAC,IAAI,EAAE,sBAAsB,EAAE;MAChDC,UAAU,EAAE,IAAI;MAChBC,YAAY,EAAE,IAAI;MAClBC,QAAQ,EAAE,IAAI;MACdC,KAAK,EAAE,KAAK;IAChB,CAAC,CAAC;IACFL,MAAM,CAACC,cAAc,CAAC,IAAI,EAAE,4BAA4B,EAAE;MACtDC,UAAU,EAAE,IAAI;MAChBC,YAAY,EAAE,IAAI;MAClBC,QAAQ,EAAE,IAAI;MACdC,KAAK,EAAE,KAAK;IAChB,CAAC,CAAC;IACFL,MAAM,CAACC,cAAc,CAAC,IAAI,EAAE,8BAA8B,EAAE;MACxDC,UAAU,EAAE,IAAI;MAChBC,YAAY,EAAE,IAAI;MAClBC,QAAQ,EAAE,IAAI;MACdC,KAAK,EAAE,KAAK;IAChB,CAAC,CAAC;IACFL,MAAM,CAACC,cAAc,CAAC,IAAI,EAAE,qBAAqB,EAAE;MAC/CC,UAAU,EAAE,IAAI;MAChBC,YAAY,EAAE,IAAI;MAClBC,QAAQ,EAAE,IAAI;MACdC,KAAK,EAAE,KAAK;IAChB,CAAC,CAAC;IACFL,MAAM,CAACC,cAAc,CAAC,IAAI,EAAE,qBAAqB,EAAE;MAC/CC,UAAU,EAAE,IAAI;MAChBC,YAAY,EAAE,IAAI;MAClBC,QAAQ,EAAE,IAAI;MACdC,KAAK,EAAE,KAAK;IAChB,CAAC,CAAC;IACF,IAAI,CAACV,4BAA4B,GAC7B,CAACI,MAAM,EAAEO,uCAAuC,IAC5CP,MAAM,EAAEJ,4BAA4B,MACnCX,sBAAsB,CAAC,8CAA8C,CAAC,IACnEA,sBAAsB,CAAC,kCAAkC,CAAC,CAAC;IACvE,IAAI,CAACa,iBAAiB,GAClBE,MAAM,EAAEF,iBAAiB,IACrBE,MAAM,EAAEX,YAAY,IACpBW,MAAM,EAAEQ,MAAM,IACdvB,sBAAsB,CAAC,sBAAsB,CAAC;IACtD,IAAI,CAACwB,0BAA0B,GAC3BT,MAAM,EAAES,0BAA0B,IAC9BxB,sBAAsB,CAAC,gCAAgC,CAAC;IAChE,IAAI,CAACS,qBAAqB,GACtBM,MAAM,EAAEN,qBAAqB,IACzBM,MAAM,EAAEV,gBAAgB,IACxBL,sBAAsB,CAAC,0BAA0B,CAAC;IAC1D,IAAI,CAACU,mBAAmB,GACpBK,MAAM,EAAEL,mBAAmB,IACvBV,sBAAsB,CAAC,wBAAwB,CAAC;IACxD,IAAI,CAACQ,mBAAmB,GACpBO,MAAM,EAAEP,mBAAmB,IACvBR,sBAAsB,CAAC,uBAAuB,CAAC;IACvD,IAAI,CAACyB,oBAAoB,GAAGV,MAAM,EAAEU,oBAAoB;IACxD,IAAI,CAAC,IAAI,CAACZ,iBAAiB,IAAI,CAAC,IAAI,CAACU,MAAM,IAAI,CAAC,IAAI,CAACE,oBAAoB,EAAE;MACvE,MAAM,IAAIC,KAAK,CAAC,kDAAkD,CAAC;IACvE;EACJ;EACAC,iBAAiBA,CAACC,OAAO,EAAE;IACvB,IAAI,CAAC,IAAI,CAACC,MAAM,EAAE;MACd,MAAMC,oBAAoB,GAAG;QACzBnB,4BAA4B,EAAE,IAAI,CAACA,4BAA4B;QAC/Da,0BAA0B,EAAE,IAAI,CAACA,0BAA0B;QAC3DX,iBAAiB,EAAE,IAAI,CAACA,iBAAiB;QACzCH,mBAAmB,EAAE,IAAI,CAACA,mBAAmB;QAC7Ce,oBAAoB,EAAE,IAAI,CAACA,oBAAoB;QAC/CM,OAAO,EAAE,IAAI,CAACC,YAAY,CAACD;MAC/B,CAAC;MACD,MAAME,QAAQ,GAAG/B,WAAW,CAAC4B,oBAAoB,CAAC;MAClD,MAAMI,MAAM,GAAG;QACX,GAAG,IAAI,CAACF,YAAY;QACpBD,OAAO,EAAEE,QAAQ;QACjBE,OAAO,EAAE,IAAI,CAACA,OAAO;QACrBC,UAAU,EAAE;MAChB,CAAC;MACD,IAAI,CAAC,IAAI,CAACX,oBAAoB,EAAE;QAC5BS,MAAM,CAACX,MAAM,GAAGO,oBAAoB,CAACjB,iBAAiB;MAC1D;MACA,IAAI,CAACqB,MAAM,CAACH,OAAO,EAAE;QACjB,OAAOG,MAAM,CAACH,OAAO;MACzB;MACAG,MAAM,CAACG,cAAc,GAAG;QACpB,GAAGH,MAAM,CAACG,cAAc;QACxB,YAAY,EAAEH,MAAM,CAACG,cAAc,GAAG,YAAY,CAAC,GAC7C,GAAGH,MAAM,CAACG,cAAc,CAAC,YAAY,CAAC,+BAA+B,GACrE;MACV,CAAC;MACD,IAAI,CAACR,MAAM,GAAG,IAAI9B,iBAAiB,CAAC;QAChCuC,UAAU,EAAE,IAAI,CAAC7B,qBAAqB;QACtCgB,oBAAoB,EAAE,IAAI,CAACA,oBAAoB;QAC/C,GAAGS;MACP,CAAC,CAAC;IACN;IACA,MAAMK,cAAc,GAAG;MACnB,GAAG,IAAI,CAACP,YAAY;MACpB,GAAGJ;IACP,CAAC;IACD,IAAI,IAAI,CAACf,iBAAiB,EAAE;MACxB0B,cAAc,CAACC,OAAO,GAAG;QACrB,SAAS,EAAE,IAAI,CAAC3B,iBAAiB;QACjC,GAAG0B,cAAc,CAACC;MACtB,CAAC;MACDD,cAAc,CAACE,KAAK,GAAG;QACnB,aAAa,EAAE,IAAI,CAAChC,qBAAqB;QACzC,GAAG8B,cAAc,CAACE;MACtB,CAAC;IACL;IACA,OAAOF,cAAc;EACzB;EACA;EACAG,MAAMA,CAAA,EAAG;IACL,MAAMC,IAAI,GAAG,KAAK,CAACD,MAAM,CAAC,CAAC;IAC3B,SAASE,QAAQA,CAACC,GAAG,EAAE;MACnB,OAAO,OAAOA,GAAG,KAAK,QAAQ,IAAIA,GAAG,IAAI,IAAI;IACjD;IACA,IAAID,QAAQ,CAACD,IAAI,CAAC,IAAIC,QAAQ,CAACD,IAAI,CAACG,MAAM,CAAC,EAAE;MACzC,OAAOH,IAAI,CAACG,MAAM,CAACC,sBAAsB;MACzC,OAAOJ,IAAI,CAACG,MAAM,CAACE,gCAAgC;MACnD,OAAOL,IAAI,CAACG,MAAM,CAACG,oBAAoB;MACvC,OAAON,IAAI,CAACG,MAAM,CAACI,wBAAwB;MAC3C,OAAOP,IAAI,CAACG,MAAM,CAACK,uBAAuB;IAC9C;IACA,OAAOR,IAAI;EACf;AACJ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}