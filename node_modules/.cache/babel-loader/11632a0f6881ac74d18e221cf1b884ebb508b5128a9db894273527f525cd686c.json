{"ast":null,"code":"import { parseDef } from \"../parseDef.mjs\";\nfunction decideAdditionalProperties(def, refs) {\n  if (refs.removeAdditionalStrategy === 'strict') {\n    return def.catchall._def.typeName === 'ZodNever' ? def.unknownKeys !== 'strict' : parseDef(def.catchall._def, {\n      ...refs,\n      currentPath: [...refs.currentPath, 'additionalProperties']\n    }) ?? true;\n  } else {\n    return def.catchall._def.typeName === 'ZodNever' ? def.unknownKeys === 'passthrough' : parseDef(def.catchall._def, {\n      ...refs,\n      currentPath: [...refs.currentPath, 'additionalProperties']\n    }) ?? true;\n  }\n}\nexport function parseObjectDef(def, refs) {\n  const result = {\n    type: 'object',\n    ...Object.entries(def.shape()).reduce((acc, [propName, propDef]) => {\n      if (propDef === undefined || propDef._def === undefined) return acc;\n      const parsedDef = parseDef(propDef._def, {\n        ...refs,\n        currentPath: [...refs.currentPath, 'properties', propName],\n        propertyPath: [...refs.currentPath, 'properties', propName]\n      });\n      if (parsedDef === undefined) return acc;\n      return {\n        properties: {\n          ...acc.properties,\n          [propName]: parsedDef\n        },\n        required: propDef.isOptional() && !refs.openaiStrictMode ? acc.required : [...acc.required, propName]\n      };\n    }, {\n      properties: {},\n      required: []\n    }),\n    additionalProperties: decideAdditionalProperties(def, refs)\n  };\n  if (!result.required.length) delete result.required;\n  return result;\n}","map":{"version":3,"names":["parseDef","decideAdditionalProperties","def","refs","removeAdditionalStrategy","catchall","_def","typeName","unknownKeys","currentPath","parseObjectDef","result","type","Object","entries","shape","reduce","acc","propName","propDef","undefined","parsedDef","propertyPath","properties","required","isOptional","openaiStrictMode","additionalProperties","length"],"sources":["/Users/youngchen/Downloads/cs224g-triage/node_modules/openai/src/_vendor/zod-to-json-schema/parsers/object.ts"],"sourcesContent":["import { ZodObjectDef } from 'zod';\nimport { JsonSchema7Type, parseDef } from '../parseDef';\nimport { Refs } from '../Refs';\n\nfunction decideAdditionalProperties(def: ZodObjectDef, refs: Refs) {\n  if (refs.removeAdditionalStrategy === 'strict') {\n    return def.catchall._def.typeName === 'ZodNever' ?\n        def.unknownKeys !== 'strict'\n      : parseDef(def.catchall._def, {\n          ...refs,\n          currentPath: [...refs.currentPath, 'additionalProperties'],\n        }) ?? true;\n  } else {\n    return def.catchall._def.typeName === 'ZodNever' ?\n        def.unknownKeys === 'passthrough'\n      : parseDef(def.catchall._def, {\n          ...refs,\n          currentPath: [...refs.currentPath, 'additionalProperties'],\n        }) ?? true;\n  }\n}\n\nexport type JsonSchema7ObjectType = {\n  type: 'object';\n  properties: Record<string, JsonSchema7Type>;\n  additionalProperties: boolean | JsonSchema7Type;\n  required?: string[];\n};\n\nexport function parseObjectDef(def: ZodObjectDef, refs: Refs) {\n  const result: JsonSchema7ObjectType = {\n    type: 'object',\n    ...Object.entries(def.shape()).reduce(\n      (\n        acc: {\n          properties: Record<string, JsonSchema7Type>;\n          required: string[];\n        },\n        [propName, propDef],\n      ) => {\n        if (propDef === undefined || propDef._def === undefined) return acc;\n        const parsedDef = parseDef(propDef._def, {\n          ...refs,\n          currentPath: [...refs.currentPath, 'properties', propName],\n          propertyPath: [...refs.currentPath, 'properties', propName],\n        });\n        if (parsedDef === undefined) return acc;\n        return {\n          properties: {\n            ...acc.properties,\n            [propName]: parsedDef,\n          },\n          required:\n            propDef.isOptional() && !refs.openaiStrictMode ? acc.required : [...acc.required, propName],\n        };\n      },\n      { properties: {}, required: [] },\n    ),\n    additionalProperties: decideAdditionalProperties(def, refs),\n  };\n  if (!result.required!.length) delete result.required;\n  return result;\n}\n"],"mappings":"SAC0BA,QAAQ,QAAE;AAGpC,SAASC,0BAA0BA,CAACC,GAAiB,EAAEC,IAAU;EAC/D,IAAIA,IAAI,CAACC,wBAAwB,KAAK,QAAQ,EAAE;IAC9C,OAAOF,GAAG,CAACG,QAAQ,CAACC,IAAI,CAACC,QAAQ,KAAK,UAAU,GAC5CL,GAAG,CAACM,WAAW,KAAK,QAAQ,GAC5BR,QAAQ,CAACE,GAAG,CAACG,QAAQ,CAACC,IAAI,EAAE;MAC1B,GAAGH,IAAI;MACPM,WAAW,EAAE,CAAC,GAAGN,IAAI,CAACM,WAAW,EAAE,sBAAsB;KAC1D,CAAC,IAAI,IAAI;GACf,MAAM;IACL,OAAOP,GAAG,CAACG,QAAQ,CAACC,IAAI,CAACC,QAAQ,KAAK,UAAU,GAC5CL,GAAG,CAACM,WAAW,KAAK,aAAa,GACjCR,QAAQ,CAACE,GAAG,CAACG,QAAQ,CAACC,IAAI,EAAE;MAC1B,GAAGH,IAAI;MACPM,WAAW,EAAE,CAAC,GAAGN,IAAI,CAACM,WAAW,EAAE,sBAAsB;KAC1D,CAAC,IAAI,IAAI;;AAElB;AASA,OAAM,SAAUC,cAAcA,CAACR,GAAiB,EAAEC,IAAU;EAC1D,MAAMQ,MAAM,GAA0B;IACpCC,IAAI,EAAE,QAAQ;IACd,GAAGC,MAAM,CAACC,OAAO,CAACZ,GAAG,CAACa,KAAK,EAAE,CAAC,CAACC,MAAM,CACnC,CACEC,GAGC,EACD,CAACC,QAAQ,EAAEC,OAAO,CAAC,KACjB;MACF,IAAIA,OAAO,KAAKC,SAAS,IAAID,OAAO,CAACb,IAAI,KAAKc,SAAS,EAAE,OAAOH,GAAG;MACnE,MAAMI,SAAS,GAAGrB,QAAQ,CAACmB,OAAO,CAACb,IAAI,EAAE;QACvC,GAAGH,IAAI;QACPM,WAAW,EAAE,CAAC,GAAGN,IAAI,CAACM,WAAW,EAAE,YAAY,EAAES,QAAQ,CAAC;QAC1DI,YAAY,EAAE,CAAC,GAAGnB,IAAI,CAACM,WAAW,EAAE,YAAY,EAAES,QAAQ;OAC3D,CAAC;MACF,IAAIG,SAAS,KAAKD,SAAS,EAAE,OAAOH,GAAG;MACvC,OAAO;QACLM,UAAU,EAAE;UACV,GAAGN,GAAG,CAACM,UAAU;UACjB,CAACL,QAAQ,GAAGG;SACb;QACDG,QAAQ,EACNL,OAAO,CAACM,UAAU,EAAE,IAAI,CAACtB,IAAI,CAACuB,gBAAgB,GAAGT,GAAG,CAACO,QAAQ,GAAG,CAAC,GAAGP,GAAG,CAACO,QAAQ,EAAEN,QAAQ;OAC7F;IACH,CAAC,EACD;MAAEK,UAAU,EAAE,EAAE;MAAEC,QAAQ,EAAE;IAAE,CAAE,CACjC;IACDG,oBAAoB,EAAE1B,0BAA0B,CAACC,GAAG,EAAEC,IAAI;GAC3D;EACD,IAAI,CAACQ,MAAM,CAACa,QAAS,CAACI,MAAM,EAAE,OAAOjB,MAAM,CAACa,QAAQ;EACpD,OAAOb,MAAM;AACf","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}