{"ast":null,"code":"import { ZodOptional } from \"zod\";\nimport { parseDef } from \"../parseDef.js\";\nfunction decideAdditionalProperties(def, refs) {\n  if (refs.removeAdditionalStrategy === \"strict\") {\n    return def.catchall._def.typeName === \"ZodNever\" ? def.unknownKeys !== \"strict\" : parseDef(def.catchall._def, {\n      ...refs,\n      currentPath: [...refs.currentPath, \"additionalProperties\"]\n    }) ?? true;\n  } else {\n    return def.catchall._def.typeName === \"ZodNever\" ? def.unknownKeys === \"passthrough\" : parseDef(def.catchall._def, {\n      ...refs,\n      currentPath: [...refs.currentPath, \"additionalProperties\"]\n    }) ?? true;\n  }\n}\nexport function parseObjectDef(def, refs) {\n  const forceOptionalIntoNullable = refs.target === \"openAi\";\n  const result = {\n    type: \"object\",\n    ...Object.entries(def.shape()).reduce((acc, [propName, propDef]) => {\n      if (propDef === undefined || propDef._def === undefined) return acc;\n      let propOptional = propDef.isOptional();\n      if (propOptional && forceOptionalIntoNullable) {\n        if (propDef instanceof ZodOptional) {\n          propDef = propDef._def.innerType;\n        }\n        if (!propDef.isNullable()) {\n          propDef = propDef.nullable();\n        }\n        propOptional = false;\n      }\n      const parsedDef = parseDef(propDef._def, {\n        ...refs,\n        currentPath: [...refs.currentPath, \"properties\", propName],\n        propertyPath: [...refs.currentPath, \"properties\", propName]\n      });\n      if (parsedDef === undefined) return acc;\n      return {\n        properties: {\n          ...acc.properties,\n          [propName]: parsedDef\n        },\n        required: propOptional ? acc.required : [...acc.required, propName]\n      };\n    }, {\n      properties: {},\n      required: []\n    }),\n    additionalProperties: decideAdditionalProperties(def, refs)\n  };\n  if (!result.required.length) delete result.required;\n  return result;\n}","map":{"version":3,"names":["ZodOptional","parseDef","decideAdditionalProperties","def","refs","removeAdditionalStrategy","catchall","_def","typeName","unknownKeys","currentPath","parseObjectDef","forceOptionalIntoNullable","target","result","type","Object","entries","shape","reduce","acc","propName","propDef","undefined","propOptional","isOptional","innerType","isNullable","nullable","parsedDef","propertyPath","properties","required","additionalProperties","length"],"sources":["/Users/youngchen/Downloads/cs224g-triage/node_modules/zod-to-json-schema/dist/esm/parsers/object.js"],"sourcesContent":["import { ZodOptional } from \"zod\";\nimport { parseDef } from \"../parseDef.js\";\nfunction decideAdditionalProperties(def, refs) {\n    if (refs.removeAdditionalStrategy === \"strict\") {\n        return def.catchall._def.typeName === \"ZodNever\"\n            ? def.unknownKeys !== \"strict\"\n            : parseDef(def.catchall._def, {\n                ...refs,\n                currentPath: [...refs.currentPath, \"additionalProperties\"],\n            }) ?? true;\n    }\n    else {\n        return def.catchall._def.typeName === \"ZodNever\"\n            ? def.unknownKeys === \"passthrough\"\n            : parseDef(def.catchall._def, {\n                ...refs,\n                currentPath: [...refs.currentPath, \"additionalProperties\"],\n            }) ?? true;\n    }\n}\nexport function parseObjectDef(def, refs) {\n    const forceOptionalIntoNullable = refs.target === \"openAi\";\n    const result = {\n        type: \"object\",\n        ...Object.entries(def.shape()).reduce((acc, [propName, propDef]) => {\n            if (propDef === undefined || propDef._def === undefined)\n                return acc;\n            let propOptional = propDef.isOptional();\n            if (propOptional && forceOptionalIntoNullable) {\n                if (propDef instanceof ZodOptional) {\n                    propDef = propDef._def.innerType;\n                }\n                if (!propDef.isNullable()) {\n                    propDef = propDef.nullable();\n                }\n                propOptional = false;\n            }\n            const parsedDef = parseDef(propDef._def, {\n                ...refs,\n                currentPath: [...refs.currentPath, \"properties\", propName],\n                propertyPath: [...refs.currentPath, \"properties\", propName],\n            });\n            if (parsedDef === undefined)\n                return acc;\n            return {\n                properties: { ...acc.properties, [propName]: parsedDef },\n                required: propOptional ? acc.required : [...acc.required, propName],\n            };\n        }, { properties: {}, required: [] }),\n        additionalProperties: decideAdditionalProperties(def, refs),\n    };\n    if (!result.required.length)\n        delete result.required;\n    return result;\n}\n"],"mappings":"AAAA,SAASA,WAAW,QAAQ,KAAK;AACjC,SAASC,QAAQ,QAAQ,gBAAgB;AACzC,SAASC,0BAA0BA,CAACC,GAAG,EAAEC,IAAI,EAAE;EAC3C,IAAIA,IAAI,CAACC,wBAAwB,KAAK,QAAQ,EAAE;IAC5C,OAAOF,GAAG,CAACG,QAAQ,CAACC,IAAI,CAACC,QAAQ,KAAK,UAAU,GAC1CL,GAAG,CAACM,WAAW,KAAK,QAAQ,GAC5BR,QAAQ,CAACE,GAAG,CAACG,QAAQ,CAACC,IAAI,EAAE;MAC1B,GAAGH,IAAI;MACPM,WAAW,EAAE,CAAC,GAAGN,IAAI,CAACM,WAAW,EAAE,sBAAsB;IAC7D,CAAC,CAAC,IAAI,IAAI;EAClB,CAAC,MACI;IACD,OAAOP,GAAG,CAACG,QAAQ,CAACC,IAAI,CAACC,QAAQ,KAAK,UAAU,GAC1CL,GAAG,CAACM,WAAW,KAAK,aAAa,GACjCR,QAAQ,CAACE,GAAG,CAACG,QAAQ,CAACC,IAAI,EAAE;MAC1B,GAAGH,IAAI;MACPM,WAAW,EAAE,CAAC,GAAGN,IAAI,CAACM,WAAW,EAAE,sBAAsB;IAC7D,CAAC,CAAC,IAAI,IAAI;EAClB;AACJ;AACA,OAAO,SAASC,cAAcA,CAACR,GAAG,EAAEC,IAAI,EAAE;EACtC,MAAMQ,yBAAyB,GAAGR,IAAI,CAACS,MAAM,KAAK,QAAQ;EAC1D,MAAMC,MAAM,GAAG;IACXC,IAAI,EAAE,QAAQ;IACd,GAAGC,MAAM,CAACC,OAAO,CAACd,GAAG,CAACe,KAAK,CAAC,CAAC,CAAC,CAACC,MAAM,CAAC,CAACC,GAAG,EAAE,CAACC,QAAQ,EAAEC,OAAO,CAAC,KAAK;MAChE,IAAIA,OAAO,KAAKC,SAAS,IAAID,OAAO,CAACf,IAAI,KAAKgB,SAAS,EACnD,OAAOH,GAAG;MACd,IAAII,YAAY,GAAGF,OAAO,CAACG,UAAU,CAAC,CAAC;MACvC,IAAID,YAAY,IAAIZ,yBAAyB,EAAE;QAC3C,IAAIU,OAAO,YAAYtB,WAAW,EAAE;UAChCsB,OAAO,GAAGA,OAAO,CAACf,IAAI,CAACmB,SAAS;QACpC;QACA,IAAI,CAACJ,OAAO,CAACK,UAAU,CAAC,CAAC,EAAE;UACvBL,OAAO,GAAGA,OAAO,CAACM,QAAQ,CAAC,CAAC;QAChC;QACAJ,YAAY,GAAG,KAAK;MACxB;MACA,MAAMK,SAAS,GAAG5B,QAAQ,CAACqB,OAAO,CAACf,IAAI,EAAE;QACrC,GAAGH,IAAI;QACPM,WAAW,EAAE,CAAC,GAAGN,IAAI,CAACM,WAAW,EAAE,YAAY,EAAEW,QAAQ,CAAC;QAC1DS,YAAY,EAAE,CAAC,GAAG1B,IAAI,CAACM,WAAW,EAAE,YAAY,EAAEW,QAAQ;MAC9D,CAAC,CAAC;MACF,IAAIQ,SAAS,KAAKN,SAAS,EACvB,OAAOH,GAAG;MACd,OAAO;QACHW,UAAU,EAAE;UAAE,GAAGX,GAAG,CAACW,UAAU;UAAE,CAACV,QAAQ,GAAGQ;QAAU,CAAC;QACxDG,QAAQ,EAAER,YAAY,GAAGJ,GAAG,CAACY,QAAQ,GAAG,CAAC,GAAGZ,GAAG,CAACY,QAAQ,EAAEX,QAAQ;MACtE,CAAC;IACL,CAAC,EAAE;MAAEU,UAAU,EAAE,CAAC,CAAC;MAAEC,QAAQ,EAAE;IAAG,CAAC,CAAC;IACpCC,oBAAoB,EAAE/B,0BAA0B,CAACC,GAAG,EAAEC,IAAI;EAC9D,CAAC;EACD,IAAI,CAACU,MAAM,CAACkB,QAAQ,CAACE,MAAM,EACvB,OAAOpB,MAAM,CAACkB,QAAQ;EAC1B,OAAOlB,MAAM;AACjB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}